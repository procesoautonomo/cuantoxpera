@page "/juntada"

<CxpBreadcrumb></CxpBreadcrumb>

<div id="Cpx-Juntada-Content" class="flex flex-wrap justify-center pt-16 pb-28 px-1 max-w-2xl mx-auto">

    <CxpAddEditFriendCard @ref="cxpAddEdifRef" OnAddFriendButtonClick="AddFriend" OnButtonCloseClick="CalcelEditFriend" OnButtonOkClick="OkEditFriend"></CxpAddEditFriendCard>
    
    @foreach (var _friend in friends)
    {
        <CxpFriendCard friend="_friend" OnButtonDeleteClickEvent="DeleteFriend" OnButtonEditClickEvent="EditFriend"></CxpFriendCard>
    }
    
</div>

@code {
    CxpAddEditFriendCard cxpAddEdifRef = new CxpAddEditFriendCard();
    Friend friend;
    List<Friend> friends = new List<Friend>();

    private void AddFriend()
    {
        friend = new Friend();
        friend.Amount = 0;
        friend.Name = "";
        friend.Initials = "FN";
        friend.CxpAmout = 0;
        friend.State = FriendState.Adding;

        cxpAddEdifRef.EditingFriend = friend;

        friend = null;
    }

    private void OkEditFriend()
    {
        friend = cxpAddEdifRef.EditingFriend;
        friend.State = FriendState.Save;
        friends.Add(friend);
        cxpAddEdifRef.EditingFriend = null;
    }

    private void CalcelEditFriend()
    {
        friend = cxpAddEdifRef.EditingFriend;
        if (friend.State == FriendState.Adding)
        {
            cxpAddEdifRef.EditingFriend = null;
        }
        else
        {
            friend.State = FriendState.Save;
            friends.Add(friend);
            cxpAddEdifRef.EditingFriend = null;
        }
    }


    private void DeleteFriend(Friend fr)
    {
        friends.Remove(fr);
    }

    private void EditFriend(Friend fr)
    {
        friends.Remove(fr);
        friend = fr;
        friend.State = FriendState.Editig;
        cxpAddEdifRef.EditingFriend = friend;
        friend = null;
    }
}
